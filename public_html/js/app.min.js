function showAnswerType(t,e){t.preventDefault();var i=$(e).parents("fieldset"),e=$(e);if($(".filetype_error",i).hide(),i.removeClass("error"),$("div.error",i).removeClass("error"),e.hasClass("active"))return!1;switch($(".type_select",i).removeClass("active"),$("input, textarea",i).prop("required",!1),e.addClass("active"),i.find(".type_input").hide(),e.data("type")){case"text":$(".text textarea",i).prop("required",!0),$(".text",i).slideDown();break;case"image":$(".upload .label",i).html("Select an image to upload <small>(JPG, PNG or GIF, &lt;5MB)</small>"),$(".upload input",i).prop("required",!0),i.find(".upload").slideDown();break;case"video":$(".url input",i).prop("required",!0),$(".url",i).slideDown();break;case"file":i.find(".upload .label").html('Select a PDF to upload. <small>(&lt;5MB. If the file is too large you can use <a href="http://smallpdf.com/compress-pdf">this free tool</a> to resize your PDF)</small>'),$(".upload input",i).prop("required",!0),$(".upload",i).slideDown()}return $(".filetype",i).val(e.data("type")),!1}function formSubmit(t){var e={success:function(e){var i=$('*[type="submit"]',t);i.html("Submit"),i.prop("disabled",!1),i.removeClass("disabled"),e.refresh?location.reload(!0):window.location=e.url},error:function(e){console.log(e),$(".json.error").remove();var i=$('*[type="submit"]',t);i.html("Submit"),i.prop("disabled",!1),i.removeClass("disabled"),e.responseJSON?$.each(e.responseJSON,function(e,i){t.prepend('<small class="error json" style="display: block">'+i+"</small>")}):t.prepend('<small class="error json" style="display: block">Oops, something went wrong while submitting the form. Please check if the entered information is correct and try again. If the error remains, please use the feedback form to contact the system administrator.</small>')}};t.ajaxSubmit(e)}function render(t,e,i,n){function a(){t.stop(!0,!0),t.find(".loader").hide(),t.find(".artefact").fadeIn();var e=$(".artefact img",t)[0];o&&(e.naturalHeight>$(".artefact img",t).height()||e.naturalWidth>$(".artefact img",t).width())&&(t.find("#artefact").append('<button class="secondary square expand" data-log-scroll data-log="30"><i class="fi-arrows-out"></i></button>'),t.find(".expand").on("click",function(){t.find(".artefact").toggleClass("expanded"),t.find(".expand i").toggleClass("fi-arrows-out"),t.find(".expand i").toggleClass("fi-arrows-in")}))}var s,r=!1,o=!1;switch(void 0==n&&(n="artefact"),void 0==i&&(i="medium"),t.find(".artefact").hide(),t.find(".loader").show(),e.type_id){case 28:s='<div class="textContainer"><div class="text"><h2>'+e.title+"</h2>"+e.content+"</div></div>";break;case 29:case 30:s='&nbsp;<img src="/'+n+"/"+e.id+"/"+i+'">',"original"==i&&(o=!0),r=!0;break;case 31:s='<iframe  src="'+e.content+'?autoplay=0" width="100%" height="100%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';break;case 32:s='<iframe src="'+e.content+'" width="100%" height="100%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';break;case 33:case 34:s='<object data="/'+n+"/"+e.id+'/original" type="application/pdf"><a href="/'+n+"/"+e.id+"/original\">Click to view PDF</a><br/><small>(Your browser does not support viewing of PDF's inside bMOOC)</small></object>";break;default:s="<p>Oops, there was an error loading the artefact.<br />Please try reloading this page.</p>"}t.find(".artefact").html(s),r?t.imagesLoaded(function(){a()}):a()}function update(t,e){t.find("[data-attr=title]").html(e.title),t.find("[data-attr=created_at]").html(e.created_at),t.find("[data-attr=author]").html('<a href="/search/'+e.author.id+'">'+e.author.name+"</a>"),tags=t.find("[data-attr=tags]"),tags.html("");for(var i=0;i<e.tags.length;i++)tags.append('<li><a href="/search/all/'+e.tags[i].id+'">'+e.tags[i].tag+"</a></li>")}function parseDate(t){var e=t.substring(0,t.indexOf(" ")),i=t.substring(t.indexOf(" ")+1),n=e.substring(0,4),a=e.substring(5,7),s=e.substring(8,10);return s+"/"+a+"/"+n+" "+i.substring(0,i.length-3)}function splitString(t){return t.replace(/(\w{12})(?=.)/g,"$1 ")}$(document).foundation({abide:{timeout:1e3,patterns:{day_month_year:/(0[1-9]|[12][0-9]|3[01])[- \/.](0[1-9]|1[012])[- \/.](19|20)\d\d/},validators:{tag_new:function(){var t=[],e=!0;return $('[data-abide-validator="tag_new"]').each(function(){$.inArray($(this).val(),t)>-1&&(e=!1),t.push($(this).val())}),e},tag_existing:function(t){var e=[],i=!0;return $("#old_tags input[type=checkbox]:checked").each(function(){$.inArray($(this).next().text(),e)>-1&&(i=!1),e.push($(this).next().text())}),$('[data-abide-validator="tag_existing"]').each(function(){$.inArray($(this).val(),e)>-1&&(i=!1),e.push($(this).val())}),(""==t.value||null==t.value)&&(i=!1),i},tag_select:function(t,e,i){var n=!0;return i.parent().find("input").length&&(2!=i.parent().find("input:checked").length?(n=!1,i.parent().find("small.error").css("display","block")):i.parent().find("small.error").css("display","none")),n},filesize:function(t,e,i){var n=!0;if(msg="",!e)return n;if(t.files.length>0){var a=t.files[0];a.size>512e4&&(n=!1,$("small.error",i).text("The file is too large (> 5MB)"))}else n=!1,$("small.error",i).text("Please select a file to upload");return n},quill:function(t,e,i){var n=!0;return e?($(t).val(i.find(".ql-editor").html()),0==i.find(".ql-editor").text().length&&(n=!1),n):n}}}});var Input=function(){function t(t){this.el=t,this.input=this.el.find(".inputfile"),this.filename=this.el.find(".file_filename");var e=this;this.el.find(".file_reset").on("click",function(t){t.preventDefault(),e.input.wrap("<form></form>").closest("form").get(0).reset(),e.input.unwrap(),e.input.trigger("change")}),this.input.on("change",function(t){var i="";this.files&&this.files.length>1?i=(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):t.target.value&&(i=t.target.value.split("\\").pop()),e.filename.html(i),console.log(e.filename.html())}),this.input.on("focus",function(){$input.addClass("has-focus")}).on("blur",function(){$input.removeClass("has-focus")})}return t}();$(function(){$("button .clear").on("click",function(){var t=$("#control");t.replaceWith(t.val("").clone(!0))})}),$(function(){$(".fileupload").each(function(){new Input($(this))})}),$(function(){$("#feedback").submit(function(t){t.preventDefault();var e=$("#feedback #fb_name").val(),i=$("#feedback #fb_mail").val(),n=$("#feedback #fb_msg").val(),a=$('#feedback input[name="_token"]').val();$.ajax({type:"POST",url:"/feedback",data:{name:e,email:i,body:n,_token:a},success:function(t){$("#feedback .mailstatus").addClass("success"),$("#feedback .mailstatus").html(t),$("#feedback .mailstatus").css("display","block"),setTimeout(function(){$("#feedback .mailstatus").slideUp()},5e3)},fail:function(t){$("#feedback .mailstatus").html(t),$("#feedback .mailstatus").css("display","block"),setTimeout(function(){$("#feedback .mailstatus").slideUp()},5e3)}})})}),$(function(){$('*[data-abide="ajax"]').on("valid.fndtn.abide",function(t){var e=$(this);t.preventDefault();var i=$('*[type="submit"]',e);i.html('<img src="/img/loader_transparent.gif" /> Submitting...'),i.prop("disabled",!0),i.addClass("disabled");var n=$("#upload input",e),a=e.parents("[data-reveal]");if(n.length){n=n[0];var s=new Thumbnail(n,100),r=new Thumbnail(n,1e3);$.when(s.generate(),r.generate()).done(function(){s.hasData&&$("<input>",{type:"hidden",id:"thumbnail_small",name:"thumbnail_small",value:s.get()}).appendTo(e),r.hasData&&$("<input>",{type:"hidden",id:"thumbnail_large",name:"thumbnail_large",value:r.get()}).appendTo(e),formSubmit(e,a)}).fail(function(){formSubmit(e,a)})}else formSubmit(e,a)})});var Thumbnail=function(){function t(t,e){this.dfd=new $.Deferred,this.c=document.createElement("canvas"),this.ctx=this.c.getContext("2d"),this.el=t,this.size=e,this.hasData=!1,this.file=null}function e(){var t={isSupported:!0,msg:"Browser supports thumbnail generation."};return window.File&&window.FileReader&&window.FileList&&window.Blob?this.el?this.el.files?this.el.files[0]||(t={isSupported:!1,msg:"No file selected."}):t={isSupported:!1,msg:"This browser doesn't seem to support the 'files' property of file inputs."}:t={isSupported:!1,msg:"Couldn't find the fileinput element."}:t={isSupported:!1,msg:"The File APIs are not fully supported in this browser."},t}function i(t){for(var e=t.indexOf(n)+n.length,i=t.substring(e),a=window.atob(i),s=a.length,r=new Uint8Array(new ArrayBuffer(s)),o=0;s>o;o++)r[o]=a.charCodeAt(o);return r}var n=";base64,";return t.prototype.generate=function(){var t=e.call(this);return t.isSupported?(this.file=this.el.files[0],this.readFile()):this.dfd.reject(t.msg),this.dfd.promise()},t.prototype.get=function(){return this.c.toDataURL("image/png")},t.prototype.readFile=function(){var t=new FileReader,e=this;t.onload=function(t){if(e.file.type.match("image.*")){var n=new Image;n.onload=function(){e.render(n)},n.onerror=function(){e.dfd.reject("Failed to read the image")},n.src=t.target.result}else if(e.file.type.match("application/pdf")||e.file.type.match("application/x-pdf")){var a=i(t.target.result);e.renderPDF(a)}else e.dfd.reject("The uploaded file was not an image, nor a pdf")},t.onerror=function(){e.dfd.reject("Failed to read the file")},t.readAsDataURL(e.file)},t.prototype.render=function(t){var e=t.height/t.width;if(e>1){if(t.height<this.size)return void this.dfd.resolve();this.c.height=this.size,this.c.width=this.size/e}else{if(t.width<this.size)return void this.dfd.resolve();this.c.width=this.size,this.c.height=this.size*e}this.ctx.drawImage(t,0,0,this.c.width,this.c.height),this.hasData=!0,this.dfd.resolve()},t.prototype.renderPDF=function(t){var e=this;PDFJS.workerSrc="/js/pdf.worker.js",PDFJS.getDocument(t).then(function(t){t.getPage(1).then(function(t){var i=t.getViewport(1),n=i.height/i.width;if(n>1){var a=e.size/i.height;i=t.getViewport(a)}else{var a=e.size/i.width;i=t.getViewport(a)}e.c.height=i.height,e.c.width=i.width;var s={canvasContext:e.ctx,viewport:i},r=t.render(s);r.promise.then(function(){e.hasData=!0,e.dfd.resolve()})})})},t}(),Vis=function(){function t(t,e,i,n){this.options={interactive:!0,type:"tree",mode:"nodes",background:!0,fit:!0,collide:!0,resize:!0,rotate:!1},"undefined"!=typeof n&&("undefined"!=typeof n.interactive&&(this.options.interactive=n.interactive),"undefined"!=typeof n.type&&(this.options.type=n.type),"undefined"!=typeof n.mode&&(this.options.mode=n.mode),"undefined"!=typeof n.background&&(this.options.background=n.background),"undefined"!=typeof n.fit&&(this.options.fit=n.fit),"undefined"!=typeof n.collide&&(this.options.collide=n.collide),"undefined"!=typeof n.resize&&(this.options.resize=n.resize),"undefined"!=typeof n.rotate&&(this.options.rotate=n.rotate)),this.data=e,this.el=t,this.url=i,this.zoomListener=d3.behavior.zoom().on("zoom",this.zoomed),this.hasZoom=!1,d3.select(this.el).attr("data-log-scroll","").attr("data-log-scroll-up","19").attr("data-log-scroll-down","20"),this.svg=d3.select(this.el).append("svg").attr("width","100%").attr("height","99%").attr("class","vis"),this.container=this.svg.append("g").attr("class","vis_container"),this.zoomContainer=this.container.append("g").attr("class","vis_zoom"),this.g=this.zoomContainer.append("g"),this.width=function(){return this.el.getBoundingClientRect().width},this.height=function(){return this.el.getBoundingClientRect().height}}return t.IMAGE_SIZE=100,t.MARGIN={top:t.IMAGE_SIZE/2,right:t.IMAGE_SIZE/2,bottom:t.IMAGE_SIZE/2,left:t.IMAGE_SIZE/2},t.TEXTBOUNDS={width:t.IMAGE_SIZE,height:t.IMAGE_SIZE,resize:!0},t.prototype.render=function(){if(d3.select(this.el).select(".vis_container").remove(),d3.select(this.el).selectAll(".vis-gui.zoom").remove(),this.container=this.svg.insert("g",":first-child").attr("class","vis_container"),this.zoomContainer=this.container.append("g").attr("class","vis_zoom"),this.g=this.zoomContainer.append("g").attr("class","vis_data"),this.options.interactive>=1){this.zoomContainer.insert("rect",":first-child").attr("class","vis_zoom-capture").style("visibility","hidden").attr("x",this.g.node().getBBox().x-25).attr("y",this.g.node().getBBox().y-25).attr("width",this.g.node().getBBox().width+50).attr("height",this.g.node().getBBox().height+50),this.container.call(this.zoomListener);var t=d3.select(this.el).append("div").attr("class","vis-gui zoom").attr("data-help","all").attr("data-help-id","vis_gui"),e=this;t.append("button").attr("class","secondary square rotate").attr("data-log","18").html("&#x21bb;&#xfe0e;").on("click",function(){e.options.rotate=!e.options.rotate,e.draw()}),t.append("button").attr("class","secondary square zoom-in").attr("data-log","19").html('<i class="fi-plus"></i>').on("click",function(){e.zoom(.1)}),t.append("button").attr("class","secondary square zoom-out").attr("data-log","20").html('<i class="fi-minus"></i>').on("click",function(){e.zoom(-.1)})}var e=this;"tree"==this.options.type&&this.renderTree(),"network"==this.options.type&&this.renderForce(),this.options.resize&&d3.select(window).on("resize",function(){e.fit()})},t.prototype.draw=function(){this.drawNodes(),this.drawLinks(),this.options.fit&&this.fit()},t.prototype.fit=function(){if(width=this.width(),height=this.height(),0!=width&&0!=height){var e=1,i=this.g.node().getBBox().width+2*t.MARGIN.left,n=this.g.node().getBBox().height+2*t.MARGIN.top;i>width&&(e=width/i),n>height&&e>height/n&&(e=height/n),t_w=-this.g.node().getBBox().x*e+(width-i*e)/2+t.MARGIN.left*e,t_h=-this.g.node().getBBox().y*e+(height-n*e)/2+ +(t.MARGIN.top*e),this.zoomListener.scale(e).translate([t_w,t_h]).scaleExtent([e,1]),this.zoomListener.scale(e).translate([t_w,t_h]).scaleExtent([e,1]),this.svg.transition().duration(125).call(this.zoomListener.event),1!=e&&(this.hasZoom=!0)}},t.prototype.resize=function(){width=this.width(),height=this.height();var t=this.zoomListener.scale(),e=this.g.node().getBBox().width,i=this.g.node().getBBox().height;t_w=width/2-e/2*t,t_h=-this.g.node().getBBox().y*t+(height-i*t)/2,this.zoomListener.scale(t).translate([t_w,t_h]).event(d3.select(this.el)),1!=t&&(this.hasZoom=!0)},t.prototype.updateZoom=function(){this.options.interactive>=1&&this.zoomContainer.select(".vis_zoom-capture").attr("x",this.g.node().getBBox().x-25).attr("y",this.g.node().getBBox().y-25).attr("width",this.g.node().getBBox().width+50).attr("height",this.g.node().getBBox().height+50)},t.prototype.zoom=function(t){this.zoomListener.scale(this.zoomListener.scale()+t).event(d3.select(this.el))},t.prototype.zoomed=function(){d3.select(this).select(".vis_zoom").attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")"),d3.select(window).on("mouseup.zoom",function(){d3.select(window).on("mousemove.zoom",null).on("mouseup.zoom",null)})},t.prototype.renderTree=function(){if(console.log("render: tree"),null==this.data.tree)throw"Vis error: no data provided to render.";treelayout=d3.layout.tree().nodeSize([t.IMAGE_SIZE,t.IMAGE_SIZE]),this.nodes=treelayout.nodes(this.data.tree),this.links=treelayout.links(this.nodes),this.nodes.forEach(function(e){e.y=e.depth*(t.IMAGE_SIZE+t.IMAGE_SIZE/10)}),this.draw()},t.prototype.renderForce=function(){function t(){r.g.append("g").selectAll(".linktext").remove();var t=10;requestAnimationFrame(function i(){for(var n=0;t>n;n++)o.tick();if(!r.options.collide)for(var a=d3.geom.quadtree(r.nodes),n=0,s=r.nodes.length;++n<s;)a.visit(e(r.nodes[n]));o.alpha()>0&&requestAnimationFrame(i)})}function e(t){var e=10;return function(i){var n=!1;if(i.point&&i.point!==t){var a,s,r,o=t.x-i.point.x,l=t.y-i.point.y,d=(i.point.width+t.width)/2+e,h=(i.point.height+t.height)/2+e,c=Math.abs(o),u=Math.abs(l);d>c&&h>u&&(a=Math.sqrt(o*o+l*l),s=(c-d)/a,r=(u-h)/a,Math.abs(s)>Math.abs(r)?s=0:r=0,t.x-=o*=s,t.y-=l*=r,i.point.x+=o,i.point.y+=l,n=!0)}return n}}function i(){if(!l){l=!0;{r.g.insert("g",":first-child").selectAll(".linktext").data(r.links).enter().append("g").attr("class","linktext").append("text").attr("y","-20").attr("text-anchor","middle").append("textPath").attr("startOffset","50%").attr("xlink:href",function(t,e){return"#linkId_"+e}).text(function(t){for(var e=[],i=0;i<t.value.length;i++)e.push(t.value[i].tag);return e.join(", ")})}r.draw()}}if(console.log("render: force"),null==this.data.list)throw"Vis error: no data provided to render.";var n=this.data.list,a=this.data.links,s=[],r=this,o=d3.layout.force().size([this.width(),this.height()]).gravity(0).charge(0).linkStrength(0);a.forEach(function(t){var e=n.indexOf(n.filter(function(e){return e.id===t.source})[0]),i=n.indexOf(n.filter(function(e){return e.id===t.target})[0]);e>-1&&i>-1&&s.push({source:e,target:i,value:t.links})}),n.forEach(function(t,e){t.px=void 0,t.py=void 0,t.x=e*(r.width()/n.length),t.y=Math.random()*r.height(),t.width=500,t.height=50}),this.nodes=n,this.links=s,o.nodes(this.nodes).links(this.links).on("start",t).on("end",i).start(),2==this.options.interactive&&node.call(o.drag);var l=!1},t.prototype.drawNodes=function(){var e=this,i=this.g.selectAll(".node").data(this.nodes),n=i.enter().append("g").attr("class","node").attr("id",function(t){return t.id});if(this.options.rotate?i.attr("transform",function(e){return"translate("+parseInt(e.y-t.IMAGE_SIZE/4)+","+e.x+")"}):i.attr("transform",function(e){return"translate("+parseInt(e.x-t.IMAGE_SIZE/2)+","+e.y+")"}),"all"==this.options.mode){n.filter(function(t){return t.hidden}).append("a").attr("xlink:href",function(t){return"/"+e.url+"/"+t.id}).append("circle").attr("cx",5).attr("cy",0).attr("r",5),n.filter(function(t){return t.type_id>28}).filter(function(t){return!t.hidden}).append("a").attr("data-log",function(t){return t.title}).attr("xlink:href",function(t){return"/"+e.url+"/"+t.id}).append("image").attr("xlink:href",function(t){return"/artefact/"+t.id+"/thumbnail/"}).attr("y",-t.IMAGE_SIZE/2).attr("width",t.IMAGE_SIZE).attr("height",t.IMAGE_SIZE);var a=n.filter(function(t){return 28==t.type_id}).filter(function(t){return!t.hidden}).append("rect").attr("width",t.IMAGE_SIZE).attr("height",t.IMAGE_SIZE).attr("y",-t.IMAGE_SIZE/2);this.options.background&&a.attr("class","filled"),n.filter(function(t){return 28==t.type_id}).filter(function(t){return!t.hidden}).append("a").attr("data-log",function(t){return t.title}).attr("xlink:href",function(t){return"/"+e.url+"/"+t.id}).append("text").attr("y",-t.IMAGE_SIZE/2).text(function(t){return splitString(t.title)}).each(function(){d3plus.textwrap().config(t.TEXTBOUNDS).valign("middle").align("center").container(d3.select(this)).draw()})}else if("nodes"==this.options.mode)n.append("a").attr("xlink:href",function(t){return"/"+e.url+"/"+t.id}).append("circle").attr("cx",0).attr("cy",0).attr("r",5).append("title").text(function(t){return t.title});else if("text"==this.options.mode){var s=n.append("g").append("a").attr("data-log",function(t){return t.title}).attr("xlink:href",function(t){return"/"+e.url+"/"+t.id});if(this.options.background){var a=s.append("text").attr("class","title stroke").text(function(t){return t.title});a.append("tspan").attr("class","small").text(function(t){var e="";return t.active||(e+=" (inactive)"),t.archived&&(e+=" (archived)"),e})}var r=s.append("text").attr("class",function(t){var e="title";return t.active||(e+=" archived"),e}).text(function(t){return t.title});r.append("tspan").attr("class","small").text(function(t){var e="";return t.active||(e+=" (inactive)"),t.archived&&(e+=" (archived)"),e})}this.updateZoom()},t.prototype.drawLinks=function(){var t=this.g.selectAll("path.link").data(this.links);if(this.options.rotate)var e=d3.svg.diagonal().projection(function(t){return[t.y,t.x]});else var e=d3.svg.diagonal().projection(function(t){return[t.x,t.y]});t.enter().insert("path","g").attr("class","link").attr("id",function(t,e){return"linkId_"+e}),t.attr("d",e)},t}(),Timeline=function(){function t(t,e,i){var n=this;this.vis=t,this.formatDate=d3.time.format("%d %b %Y"),this.max=d3.max(this.vis.data.list,function(t){var e=d3.time.format("%Y-%m-%d %H:%M:%S").parse(t.created_at);return e}),"undefined"!=typeof i&&(this.max=d3.max([this.max,d3.time.format("%Y-%m-%d %H:%M:%S").parse(i)])),this.min=d3.min(this.vis.data.list,function(t){var e=d3.time.format("%Y-%m-%d %H:%M:%S").parse(t.created_at);return e}),"undefined"!=typeof e&&(this.min=d3.min([this.min,d3.time.format("%Y-%m-%d %H:%M:%S").parse(e)])),this.end=d3.min([this.max,new Date]),this.startingValue=this.end,this.timeScale=d3.time.scale().domain([this.min,this.max]).range([100,this.vis.width()-100]).clamp(!0),this.brush=d3.svg.brush().x(this.timeScale).extent([this.max,this.max]).on("brush",function(){n.brushed(this)}),this.axis=d3.svg.axis().scale(this.timeScale).orient("bottom").tickFormat(function(t){return n.formatDate(t)}).tickSize(0).tickPadding(12).tickValues([this.timeScale.domain()[0],this.timeScale.domain()[1]])}return t.prototype.resize=function(){this.stop(),this.timeScale.range([100,this.vis.width()-100]),d3.select(".x.axis").attr("transform","translate(0,"+(this.vis.height()-Vis.MARGIN.top)+")").call(this.axis),d3.select(".slider").attr("transform","translate(0, "+(this.vis.height()-Vis.MARGIN.top)+")");var t=this.brush.extent()[0];d3.select(this.vis.el).select(".handle").attr("transform","translate("+this.timeScale(t)+",0)")},t.prototype.brushed=function(t){var e=this;if(t&&d3.event.sourceEvent){var i=this.timeScale.invert(d3.mouse(t)[0]);this.brush.extent([i,i])}this.brush.extent()[0]>this.end&&this.brush.extent([this.end,this.end]);var i=this.brush.extent()[0];d3.select(this.vis.el).select(".handle").attr("transform","translate("+this.timeScale(i)+",0)"),d3.select(this.vis.el).select(".handle").select("text").text(this.formatDate(i)),this.vis.g.selectAll("g.node").attr("display","block"),this.vis.g.selectAll(".link").attr("display","block"),this.vis.g.selectAll("g.node").filter(function(t){var i=d3.time.format("%Y-%m-%d %H:%M:%S").parse(t.created_at);return i>e.brush.extent()[0]}).attr("display","none"),this.vis.g.selectAll(".link").filter(function(t){var i=d3.time.format("%Y-%m-%d %H:%M:%S").parse(t.target.created_at);return i>e.brush.extent()[0]}).attr("display","none"),this.vis.g.selectAll(".linktext").filter(function(t){var i=d3.time.format("%Y-%m-%d %H:%M:%S").parse(t.target.created_at);return i>e.brush.extent()[0]}).attr("display","none"),this.vis.options.fit&&this.vis.fit()},t.prototype.show=function(){var t=this;this.vis.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+(this.vis.height()-Vis.MARGIN.top)+")").call(this.axis).select(".domain");var e=this.vis.svg.append("g").attr("class","slider").attr("transform","translate(0, "+(this.vis.height()-Vis.MARGIN.top)+")").call(this.brush);e.selectAll(".extent,.resize").remove(),e.select(".background").attr("height",25).attr("transform","translate(0,-12)");var i=e.append("g").attr("class","handle");i.append("circle").attr("r",5),i.append("text").text(this.startingValue).attr("class","lbl").attr("transform","translate(0 ,-20)"),e.call(this.brush.event);var n=d3.select(vis.el).append("div").attr("class","vis-gui timeline").attr("data-help","all").attr("data-help-id","vis_timeline"),t=this;n.append("button").attr("class","secondary square rewind inline").attr("data-log","15").html('<i class="fi-rewind"></i>').on("click",function(){t.rewind()}),n.append("button").attr("class","secondary square stop inline").attr("data-log","16").html('<i class="fi-stop"></i>').on("click",function(){t.stop()}),n.append("button").attr("class","secondary square forward inline").attr("data-log","17").html('<i class="fi-fast-forward"></i>').on("click",function(){t.forward()}),this.vis.options.resize&&d3.select(window).on("resize",function(){t.resize(),t.vis.fit()})},t.prototype.setDate=function(t){this.brush.extent([t,t]),d3.select(".slider").call(this.brush.event)},t.prototype.mark=function(t){lastVisit=d3.select(".slider").append("g").attr("class","mark").attr("transform","translate("+this.timeScale(t)+",0)"),lastVisit.append("circle").attr("r",5).attr("class","marker")},t.prototype.hide=function(){},t.prototype.forward=function(){var t=this,e=this.brush.extent();this.brush.extent([this.end,this.end]),d3.select(".slider").transition().ease(d3.ease("linear")).duration(function(){return(5e3+200*d3.select(this.parentNode).selectAll("g.node").size())*Math.abs((t.end-e[0])/(t.max-t.min))}).call(this.brush.event)},t.prototype.rewind=function(){var t=this,e=this.brush.extent();this.brush.extent([this.min,this.min]),d3.select(".slider").transition().ease(d3.ease("linear")).duration(function(){return(5e3+200*d3.select(this.parentNode).selectAll("g.node").size())*Math.abs((e[0]-t.min)/(t.max-t.min))}).call(this.brush.event)},t.prototype.stop=function(){d3.select(".slider").transition()},t.prototype.update=function(){d3.select(".slider").call(this.brush.event)},t.prototype.toStart=function(){},t.prototype.toEnd=function(){},t}(),Menu=function(){function t(t,e,i,n,a){this.menu=$("#"+t),this.svg=$("#"+e),this.html=$("#"+i),this.vis=n,this.firstClick=!0,this.options={enabled:["list"],"default":"list"},"undefined"!=typeof a&&("undefined"!=typeof a.enabled&&(this.options.enabled=a.enabled),"undefined"!=typeof a.default&&(this.options.default=a.default)),this.init()}return t.prototype.init=function(){var t=this;$(".button",this.menu).each(function(){$.inArray($(this).data("vis"),t.options.enabled)>=0?$(this).on("click",function(){hash=window.location.hash.substring(1),$(".button",t.menu).removeClass("active"),$(this).addClass("active"),t.firstClick||$(".dropdown").hide(),t.firstClick=!1,"undefined"!=typeof $(this).attr("data-svg")?(t.html.hide(),t.svg.show(),t.vis.options.rotate="tree"==$(this).attr("data-vis")?!0:!1,t.vis.options.type=$(this).attr("data-vis"),t.vis.render()):(t.svg.hide(),t.html.show(),"list"==$(this).attr("data-vis")&&($("[vis-grid]").hide(),$("[vis-list]").show(),$(".list",t.html).removeClass("grid"),$(".list",t.html).addClass("block")),"grid"==$(this).attr("data-vis")&&($("[vis-list]").hide(),$("[vis-grid]").show(),$(".list",t.html).removeClass("block"),$(".list",t.html).addClass("grid")))}):($(this).addClass("disabled"),$(this).on("click",function(t){t.preventDefault()}))}),window.onpopstate=function(){t.update()},this.update()},t.prototype.update=function(){window.location.hash&&$.inArray(window.location.hash.substring(1),this.options.enabled)>=0?$("[data-vis="+window.location.hash.substring(1)+"]",this.menu).click():$("[data-vis="+this.options.default+"]",this.menu).click()},t}();$(function(){function t(t){t.timestamp=Date.now()/1e3;var e=JSON.parse(localStorage.log);e.push(t),localStorage.log=JSON.stringify(e)}function e(){var t=localStorage.log;void 0!=t&&t.length>0&&($(".logging-gui .toggle").toggle(),$.ajax({type:"POST",url:"/log/save",data:{log:t},success:function(){eraseCookie("logging"),localStorage.removeItem("log"),window.location.replace("/me")},fail:function(t){console.log(t)},dataType:"JSON"}))}function i(){var e=prompt("Comment:","");null!=e&&t({event:"comment",description:e})}if(logging=readCookie("logging"),null!=logging){$(".logging-gui").show(),$("[data-reveal-id=new_log]").hide(),Date.now||(Date.now=function(){return(new Date).getTime()}),("undefined"==localStorage.log||void 0==localStorage.log)&&(localStorage.log=JSON.stringify([])),$(".logging_stop").on("click",e),$(".logging_comment").on("click",i);var n="";t({event:"page",description:window.location.href}),$(document).on("click","[data-log]",function(){var e=parseInt($(this).data("log"));t(isNaN(e)?{event:"click",description:$(this).data("log")}:{event:"click",button_id:e}),n=""}),$(document).on("click",".sort",function(){t({event:"click",description:"sort by "+$(this).text().toLowerCase()}),n=""}),$(document).on("click","a:not([data-log]):not(.sort)",function(){t({event:"click",description:$(this).text()}),n=""}),$(document).on("keypress","[data-log-keyboard]",function(e){t({event:"keyboard",description:String.fromCharCode(e.which)}),n=""}),$(document).on("mousewheel","[data-log-scroll]",function(e){var i=e.originalEvent.wheelDelta<0?"down":"up";if(n!=i){n=i;var a=$(this).data("log-scroll-up"),s=$(this).data("log-scroll-down");t(void 0!=a&&void 0!=s?{event:"scroll",button_id:e.originalEvent.wheelDelta<0?s:a}:{event:"scroll",description:i})}})}});
